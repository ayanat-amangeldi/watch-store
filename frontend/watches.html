<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buy Watches | SÜLU</title>

<link rel="stylesheet" href="./css/header.css">

<style>

:root {
  --bg: #F6F6F4;
  --card: #FFFFFF;
  --primary: #1C2A3A;
  --gold: #B89B5E;
  --text-light: #666;
}

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: var(--bg);
}

/* ===== PAGE ===== */

.page {
  padding: 60px 100px;
}

.page h1 {
  font-size: 40px;
  margin-bottom: 40px;
}

/* ===== FILTER BAR ===== */

.filter-bar {
  display: flex;
  gap: 20px;
  margin-bottom: 50px;
}

.filter-bar input,
.filter-bar select {
  padding: 10px 15px;
  border: 1px solid #ddd;
  background: white;
}

.filter-bar button {
  padding: 10px 20px;
  background: var(--primary);
  color: white;
  border: none;
  cursor: pointer;
}

/* ===== GRID ===== */

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 40px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  overflow: hidden;
  transition: 0.3s;
  box-shadow: 0 8px 20px rgba(0,0,0,0.04);
  position: relative;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.08);
}

.card img {
  width: 100%;
  height: 260px;
  object-fit: cover;
  cursor: pointer;
}

.card-content {
  padding: 18px;
}

.title {
  font-weight: 600;
  margin-bottom: 8px;
  cursor: pointer;
}

.price {
  font-weight: 600;
  color: var(--primary);
}

.add-btn {
  margin-top: 12px;
  width: 100%;
  padding: 10px;
  background: var(--primary);
  color: white;
  border: none;
  cursor: pointer;
}

.add-btn:hover {
  background: #16212d;
}

/* ===== FAVORITE HEART ===== */

.heart {
  position: absolute;
  top: 12px;
  right: 12px;
  background: white;
  width: 35px;
  height: 35px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 18px;
}

.heart:hover {
  color: var(--gold);
}

</style>
</head>

<body>
    <div id="header"></div>

<script>
fetch("./header.html")
  .then(r => r.text())
  .then(html => {
    document.getElementById("header").innerHTML = html;

    const s = document.createElement("script");
    s.src = "./js/header.js";
    document.body.appendChild(s);
  });
</script>


<div id="header"></div>

<div class="page">
  <h1>Buy Watches</h1>

  <div class="filter-bar">
    <select id="brandFilter">
      <option value="">All Brands</option>
    </select>

    <input type="number" id="minPrice" placeholder="Min price">
    <input type="number" id="maxPrice" placeholder="Max price">

    <select id="sort">
      <option value="createdAt">Newest</option>
      <option value="price">Price</option>
    </select>

    <select id="order">
      <option value="desc">Descending</option>
      <option value="asc">Ascending</option>
    </select>

    <button onclick="loadWatches()">Apply</button>
  </div>

  <div class="grid" id="grid"></div>
</div>

<script>
const API = "http://localhost:3000/api/v1";

async function loadBrands() {
  const res = await fetch(API + "/brands");
  const brands = await res.json();

  const select = document.getElementById("brandFilter");
  brands.forEach(b => {
    select.innerHTML += `<option value="${b._id}">${b.name}</option>`;
  });
}

async function loadWatches() {
  const brand = document.getElementById("brandFilter").value;
  const min = document.getElementById("minPrice").value;
  const max = document.getElementById("maxPrice").value;
  const sort = document.getElementById("sort").value;
  const order = document.getElementById("order").value;

  let query = `?sort=${sort}&order=${order}`;
  if (brand) query += `&brandId=${brand}`;
  if (min) query += `&minPrice=${min}`;
  if (max) query += `&maxPrice=${max}`;

  const res = await fetch(API + "/watches" + query);
  const watches = await res.json();

  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  watches.forEach(w => {
    grid.innerHTML += `
      <div class="card">
        <div class="heart">♡</div>

        <img src="${w.imageUrl || 
          "https://images.unsplash.com/photo-1609587312208-cea54be969e7"}"
          onclick="openDetails('${w._id}')">

        <div class="card-content">
          <div class="title"
            onclick="openDetails('${w._id}')">
            ${w.model}
          </div>

          <div class="price">$${w.price}</div>

          <button class="add-btn"
            onclick="addToCart('${w._id}')">
            Add to Cart
          </button>
        </div>
      </div>
    `;
  });
}

function openDetails(id) {
  window.location.href = `watch-details.html?id=${id}`;
}

async function addToCart(id) {
  const token = localStorage.getItem("token");
  if (!token) {
    alert("Please login first");
    return;
  }

  await fetch(API + "/cart/items", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ watchId: id, quantity: 1 })
  });

  alert("Added to cart");
}

loadBrands();
loadWatches();
</script>

</body>
</html>
